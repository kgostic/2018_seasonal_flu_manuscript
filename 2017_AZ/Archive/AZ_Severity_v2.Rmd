---
title: "AZ Severity Data"
author: "Katie Gostic"
date: "9/25/2017"
---

Load data
```{r}
rm(list = ls())
setwd('~/Dropbox/R/2017_seasonal_flu/')
ICU.subtype.birthyear = data.frame('H3N2' = c(126, 318, 39, 389), 'H1N1' = c(151, 272, 91, 526), ICU = c(1, 0, 1, 0), pre.1968 = c(1, 1, 0, 0))
```


#ICU admission by subtype, birth year
#### Compare the birth year distributions of ICU cases for H3N2 vs. H1N1
This approach considers only cases admitted to the ICU, thus getting around the expected age differences in ICU vs. non_ICU cases. (We know elderly adults are more likely to end up in the ICU, and all these adults are in the pre-1968 birth cohort.)
* If imprinting plays a role, we expect a higher fraction of H3N2-related ICU admissions to occur in pre-1968 birth years, and a higher fraction of H1N1-related ICU admissions to occur in post-1968 cohorts.

```{r echo = FALSE}
ICU.birthyear = matrix(c(126, 151, 39, 91), 2, 2, dimnames = list(c('H3', 'H1'), c('pre.1968', 'post.1968')))
print('Observed proportions of H1N1 or H3N2 cases occurring in adults born before or after 1968')
prop.table(ICU.birthyear, 1)
c.test = chisq.test(ICU.birthyear)
c.test
print('Observed counts')
ICU.birthyear
print('Expected counts if byear distribution is independent of subtype')
c.test$expected
print('Observed - Expected')
ICU.birthyear - c.test$expected
```
####This test suggests the age districutions of H1N1 vs. H3N2 ICU admissions are not independent. H3N2 ICU admissions are much more likely to have been born prior to 1968 than H1N1 ICU admissions.





```{r echo = FALSE}
Admitted.days = matrix(c(88, 71, 131, 166, 99, 130, 105, 77, 334, 249, 175, 135, 54, 33, 54, 11), ncol = 2, nrow = 8, byrow = TRUE, dimnames = list(NULL, c('H1N1', 'H3N2')))
Admitted.days = data.frame(Admitted.days, 'n.days' = c('0', '1-3', '4-7', '>7', '0', '1-3', '4-7', '>7'), 'birth.year' = c('pre.1968', 'pre.1968', 'pre.1968', 'pre.1968', 'post.1968', 'post.1968', 'post.1968', 'post.1968'), 'admitted' = c(0, 1, 1, 1, 0, 1, 1, 1), 'wk' = c(0, 0, 0, 1, 0, 0, 0, 1))
#Admitted.days
```


# Hospital admission by subtype, birth year
#### Compare birth year distributions of hospital admissions (>=1 days) for H1N1 vs. H3N2
```{r echo = FALSE}
# Admitted, pre.1968
#colSums(subset(Admitted.days, admitted == 1 & birth.year == 'pre.1968')[,1:2])
# Admitted, post.1968
#colSums(subset(Admitted.days, admitted == 1 & birth.year == 'post.1968')[,1:2])
Admitted.table = matrix(c(colSums(subset(Admitted.days, admitted == 1 & birth.year == 'pre.1968')[,1:2]), 
         colSums(subset(Admitted.days, admitted == 1 & birth.year == 'post.1968')[,1:2])), 
       nrow = 2, ncol = 2, dimnames = list(c('H1N1', 'H3N2'), c('pre.1968', 'post.1968')))
print('Observed proportions of H1N1 or H3N2 admissions occurring in adults born before or after 1968')
prop.table(Admitted.table, 1)
c.test = chisq.test(Admitted.table)
c.test
print('Observed counts')
Admitted.table
print('Expected counts if byear distribution is independent of subtype')
c.test$expected
print('Observed - Expected')
Admitted.table - c.test$expected
```

###This test suggests the age districutions of H1N1 vs. H3N2 hospital admissions are not independent. H3N2 hospital admissions are much more likely to have been born prior to 1968 than H1N1 ICU admissions.





# Hospital admissions longer than one week by subtype, birth year
```{r echo = FALSE}
# Admitted, pre.1968
#colSums(subset(Admitted.days, birth.year == 'pre.1968' & wk == 1)[,1:2])
# Admitted, post.1968
#colSums(subset(Admitted.days, birth.year == 'post.1968' & wk == 1)[,1:2])
wk.table = matrix(c(colSums(subset(Admitted.days, birth.year == 'pre.1968' & wk == 1)[,1:2]), 
         colSums(subset(Admitted.days, birth.year == 'post.1968' & wk == 1)[,1:2])), 
       nrow = 2, ncol = 2, dimnames = list(c('H1N1', 'H3N2'), c('pre.1968', 'post.1968')))
print('Observed proportions of H1N1 or H3N2 admissions lasting longer than one week and occurring in adults born before or after 1968')
prop.table(wk.table, 1)
c.test = chisq.test(wk.table)
c.test
print('Observed counts')
wk.table
print('Expected counts if byear distribution is independent of subtype')
c.test$expected
print('Observed - Expected')
wk.table - c.test$expected
```

##This test suggests the age districutions of H1N1 vs. H3N2 hospital admissions lasting greater than one week are not independent. H3N2 hospital admissions lasting greater than one week are much more likely to have been born prior to 1968 than H1N1 ICU admissions.




